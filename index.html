<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jonah Ortiz — Interview Assistant</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f0f0f0;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    aside#chat-container {
      width: 350px;
      background: #ffffff;
      border-right: 1px solid #ddd;
      display: flex;
      flex-direction: column;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      z-index: 1000;
    }

    #chat-container header {
      background: #1e1e2f;
      color: white;
      padding: 1em;
      text-align: center;
    }

    #chat {
      flex: 1;
      padding: 1em;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    form {
      display: flex;
      gap: 0.5em;
      padding: 1em;
    }

    input[type="text"] {
      flex: 1;
      padding: 0.75em;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    button {
      background: #1e1e2f;
      border: none;
      color: white;
      padding: 0 1.5em;
      font-size: 1em;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background: #333353;
    }

    .message {
      margin: 0.5em 0;
      max-width: 75%;
      padding: 0.75em 1em;
      border-radius: 15px;
      line-height: 1.3;
      word-wrap: break-word;
    }

    .user {
      background: #d0e6ff;
      color: #004a99;
      align-self: flex-end;
      border-bottom-right-radius: 2px;
    }

    .bot {
      background: #e5e5e5;
      color: #333;
      align-self: flex-start;
      border-bottom-left-radius: 2px;
    }

    .bot.typing {
      font-style: italic;
      opacity: 0.7;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { opacity: 0.5; }
      50% { opacity: 1; }
      100% { opacity: 0.5; }
    }

    main {
      margin-left: 350px;
      padding: 2em;
      flex: 1;
      overflow-y: auto;
      height: 100vh;
    }

    footer {
      text-align: center;
      padding: 1em;
      font-size: 0.8em;
      color: #888;
    }

    @media (max-width: 768px) {
      aside#chat-container {
        width: 100%;
        position: fixed;
        height: auto;
        top: auto;
        bottom: 0;
        border-right: none;
        border-top: 1px solid #ddd;
      }

      main {
        margin: 0;
        padding-bottom: 300px; /* space for the fixed chat */
      }
    }
  </style>
</head>
<body>

<aside id="chat-container">
  <header>
    <h2>Interview Assistant</h2>
    <p style="font-size: 0.9em; margin: 0;">Ask me about Jonah Ortiz</p>
  </header>
  <div id="chat" aria-live="polite" aria-atomic="false"></div>
  <form id="chat-form">
    <input type="text" id="user-input" autocomplete="off" placeholder="Type your question..." required />
    <button type="submit">Send</button>
  </form>
</aside>

<main>
  <header>
    <h1>Jonah Ortiz</h1>
    <p>Welcome! Use the assistant on the left to learn more about Jonah’s background, experience, and to schedule an interview.</p>
  </header>

  <section>
    <h2>About Jonah</h2>
    <p>Jonah Ortiz is a Business Intelligence Analyst with 10 years of experience in data analytics, working with companies like HP, Seer Interactive, and Havas Edge. He specializes in subscription analytics, agile sprints, and building self-serve data tools in Databricks and ThoughtSpot.</p>
    <!-- You can add more site content here -->
  </section>

  <footer>
    Powered by OpenAI &amp; n8n · Hosted on GitHub Pages
  </footer>
</main>

<script>
  const chat = document.getElementById('chat');
  const form = document.getElementById('chat-form');
  const input = document.getElementById('user-input');

  // Generate or retrieve sessionId
  let sessionId = sessionStorage.getItem('sessionId');
  if (!sessionId) {
    sessionId = crypto.randomUUID();
    sessionStorage.setItem('sessionId', sessionId);
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const userMessage = input.value.trim();
    if (!userMessage) return;
    input.value = '';

    appendMessage(userMessage, 'user');

    // Show typing indicator
    const typingIndicator = appendMessage('Bot is typing...', 'bot', true);
    typingIndicator.classList.add('typing');

    try {
      const response = await fetch('https://jonahgortiz.app.n8n.cloud/webhook/interview-bot', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          message: userMessage,
          sessionId: sessionId
        })
      });

      if (!response.ok) throw new Error(`Network error: ${response.status}`);

      const data = await response.json();
      const botReply = data.reply || data.message || "Sorry, I didn't get a response.";

      typingIndicator.textContent = botReply;
      typingIndicator.classList.remove('typing');
    } catch (error) {
      console.error('Chatbot error:', error);
      typingIndicator.textContent = 'Error: Unable to reach the chatbot. Please try again later.';
      typingIndicator.classList.remove('typing');
    }
  });

  function appendMessage(text, sender, returnNode = false) {
    const div = document.createElement('div');
    div.classList.add('message', sender);
    div.textContent = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
    return returnNode ? div : undefined;
  }
</script>

</body>
</html>
